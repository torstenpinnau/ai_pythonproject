<!DOCTYPE HTML>
<html>
    <head>
        <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    </head>
    <body>

    <input type="file" id="input" name="file" multiple />
    <br>
    <output id="files"></output>
    <pre id="cols">cols</pre>
    <pre id="rows">rows</pre>
        <script>

            if (window.File && window.FileReader && window.FileList && window.Blob) {
            } else {
                alert('The File APIs are not fully supported in this browser.');
            }

            function handleFileSelect(evt) {
                var files = evt.target.files;
                var output = [];
                var output1 = [];
                var cols = [];
                var result = [], stringResult, x;
                for (var i = 0, f; f = files[i]; i++) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                            var text = e.target.result;
                            var lines = text.split(/[\r\n]+/g); // tolerate both Windows and Unix linebreaks
                            for(var i = 0; i < lines.length; i++) {
                            var zeile = lines[i].split(/,+/g);

                            for(var j = 0; j < zeile.length; j++) {
                                if(j==0){
                                result.push('"'+zeile[j]+'"');
                                }
                                if(j>0){
                                result.push(',"'+zeile[j]+'"');
                                }
                            }
                                stringResult = result.join('');
                                result=[];

                                if(i==0){
                                cols.push('[' + stringResult + ']');
                                //alert(cols[0]);
                                }
                                if(i==1){
                                output.push('[[' + stringResult + ']');
                                }
                                if(i>1 && i<lines.length-1){
                                output.push('[' + stringResult + ']');
                                }
                                if(i==lines.length-1){
                                output.push('[' + stringResult + ']]');
                                }
                                }
                                //alert(output[0]);
                                test(output,cols);
                        };
                        reader.readAsText(f,"UTF-8");
                    }
                document.getElementById('files').innerHTML = 'Paths with more than 240 characters: <br><ul>' + output.join('') + '</ul>';
            }
            document.getElementById('input').addEventListener('change', handleFileSelect, false);

function test(output,cols) {

//alert(output[0]);
        $.ajax({
            url: "upload3.php",
            type: "POST",
            data:"wertJS="+output+"&cols="+cols,
            success: function(response) {
              var cols = response.split("#<*>")[0];
              $("#cols").html(cols);
              var rows = response.split("#<*>")[1];
              $("#rows").html(rows);
            }
        });
}

        </script>
    </body>
</html>